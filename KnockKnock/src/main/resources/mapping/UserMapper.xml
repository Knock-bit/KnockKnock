<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 참고파일 나중에 삭제 -->
<mapper namespace="UserVO">
	<!-- 카카오/구글 로그인 -->
	<select id="kakaologin" parameterType="UserVO" resultType="UserVO">
		SELECT *FROM USERS WHERE U_EMAIL=#{uEmail}
	</select>
	<!-- 로그인 -->
	<select id="selectlogin" parameterType="UserVO" resultType="UserVO">
		SELECT U_NAME FROM USERS WHERE U_ID=#{uId} and U_PWD=#{uPwd}
	</select>
	<!-- ID중복체크 -->
	<select id="idCheck" parameterType="String" resultType="String">
		SELECT U_IDX FROM USERS WHERE U_ID=#{id}
	</select> 
	<!-- 이메일 중복체크 -->
	<select id="emailCheck" parameterType="String" resultType="String">
		SELECT U_NAME FROM USERS WHERE U_EMAIL=#{email}
	</select>
	<!-- 닉네임 중복체크 -->
	<select id="nickCheck" parameterType="String" resultType="String">
		SELECT U_IDX FROM USERS WHERE U_NICKNAME=#{nickname}
	</select>
	<!-- 회원가입 -->
	<insert id="join" parameterType="UserVO">
		INSERT INTO USERS(U_IDX, U_ID, U_NAME, U_PWD, U_NICKNAME,U_EMAIL, U_PHONE, U_BIRTH, U_TOT_POINT, U_TYPE,
U_ACTIVE, U_GENDER, U_ADDRESS, U_JOINDATE)
		VALUES(U_IDX_SEQ.nextval, #{uId}, #{uName}, #{uPwd}, #{uNickname}, #{uEmail}, #{uPhone}, #{uBirth}, default, 1, default, #{uGender}, #{uAddress}, sysdate)		
	</insert>
	 
	
	<!-- 마이페이지 이동 -->
	<select id="selectOneUser" parameterType="int" resultType="UserVO">
		SELECT * FROM USERS WHERE U_IDX = #{uIdx}
	</select>
	
	<!-- 유저 전체목록 -->
	<select id="getAllUser" resultType="UserVO">
		SELECT * FROM USERS
	
	</select>
	
	<!-- 마이페이지 내 정보 수정(업데이트) -->
	<update id="updateMyInfo" parameterType="UserVO">
		UPDATE USERS SET 
		U_NICKNAME = #{uNickname}, U_ADDRESS=#{uAddress}, U_EMAIL=#{uEmail}, U_PHONE=#{uPhone}, U_IMG=#{uImg}, U_IMGPATH = #{uImgPath}
		WHERE U_IDX=#{uIdx}
	
	</update>
	
	<!-- 마이페이지 이메일 목록 가져오기(중복확인) -->
	<select id="getEamilList" resultType="string">
		SELECT U_EMAIL FROM USERS 
	
	</select>

	<!-- 마이페이지 비밀번호 변경 -->
	<update id="updateMyPwd" parameterType="UserVO">
		UPDATE USERS SET 
		U_PWD = #{uPwd}
		WHERE U_IDX=#{uIdx}
	
	</update>
	
	<!-- 엠블럼 리스트 -->
	<select id="userEmblemList" parameterType="UserVO" resultType="map">
		SELECT CI_EMBLEM
		FROM (SELECT C.CI_IDX,C.CI_EMBLEM, U.U_IDX, U.CI_EMBLEM_STATUS
		FROM CAMPAIGN C, CAMPAIGN_USER U
		WHERE U.CI_IDX=C.CI_IDX
		AND U.U_IDX=#{uIdx}) 
		WHERE CI_EMBLEM_STATUS=1
	
	</select>
	
	<!-- 진행중인 캠페인 리스트 -->
	<select id="userCamingList" parameterType="UserVO" resultType="campaignVO" >
		SELECT C.*
		FROM CAMPAIGN C, CAMPAIGN_USER U
		WHERE U.CI_IDX=C.CI_IDX 
		AND C.CI_STATUS=1
		AND U.U_IDX=#{uIdx}
	</select>
	
	<!-- 종료된 캠페인 리스트 -->
	<select id="endCampaignList" parameterType="UserVO" resultType="campaignVO" >
		SELECT C.*
		FROM CAMPAIGN C, CAMPAIGN_USER U
		WHERE U.CI_IDX=C.CI_IDX 
		AND C.CI_STATUS=0
		AND U.U_IDX=#{uIdx}
	</select>

	<!-- 나의 문의내역 - 총 게시글 수 구하기 -->
	<select id="myCcListTotalCount" parameterType="UserVO" resultType="int">
		SELECT COUNT(*) FROM CONTACT
    	WHERE U_IDX =#{uIdx}
	</select>
	<!-- 나의 문의내역 페이징 -->
	<select id="myCcList" parameterType="hashmap" resultType="contactVO">
		SELECT * 
		FROM ( SELECT ROWNUM RN, C.* 
		FROM ( SELECT *  FROM CONTACT 
		WHERE U_IDX = #{uIdx}
		ORDER BY CT_WRITEDATE DESC 
		) C)
		WHERE RN BETWEEN #{start} AND #{end}
	
	</select> 
	
	<!-- 내 문으내용(답글포함) -->
	<select id="myQuestionPage" parameterType="UserVO" resultType="contactVO">
		SELECT C.*, CM.*
		FROM CONTACT C LEFT OUTER JOIN (
	    SELECT * FROM CONTACT_COMMENT) CM
	    ON(C.CT_IDX = CM.CT_IDX)
	    WHERE C.U_IDX = #{uIdx}
	    AND C.CT_IDX =#{ctIdx}
	
	</select>
	
	<!-- 나의 활동 -->
	<select id="myActive" parameterType="UserVO" resultType="boardVO">
		SELECT * FROM BOARD WHERE U_IDX = #{uIdx}
	
	</select>
	
	
</mapper>