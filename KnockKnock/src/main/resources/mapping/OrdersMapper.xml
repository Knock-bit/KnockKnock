<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 참고파일 나중에 삭제 -->
<mapper namespace="Orders">
 	 
	<select id="selectOrderList" parameterType="int" resultType="ordersVO">
		SELECT *FROM ORDERS WHERE S_IDX = #{sIdx}
	</select>
	
	
	<!-- 주문(order테이블) 업데이트(결제완료 후) -->
	<update id="orderInfo" parameterType="hashmap">
		UPDATE ORDERS
		SET O_STATUS = 1, F_CHECK = 1, PA_IDX = #{paIdx}, O_DATE = SYSDATE, O_TEMPNUM = #{oTempnum}
		WHERE U_IDX = #{uIdx} AND O_STATUS = 0
	
	</update>
	
	<!-- 임시 주문 데이터에 방금 결제한 주문정보 넣어놓기 -->
	<insert id="tempOrder" parameterType="string">
		INSERT INTO ORDERS_TEMP (OT_IDX, O_TEMPNUM)
		VALUES (OT_NUM_SEQ.nextval, #{oTempnum})
	
	</insert>
	
	<!-- 수령인 정보 입력 -->
	<insert id="userOrder" parameterType="userOrderVO">
		INSERT INTO USER_ORDER 
		(G_IDX, O_ADDRESS1, O_ADDRESS2, O_PHONE,
			O_RECEIVER, O_ZIPCODE, U_IDX, O_DELIVERY)
		VALUES (G_IDX_SEQ.nextval, #{oAddress1}, #{oAddress2}, #{oPhone}, 
				#{oReceiver}, #{oZipcode}, #{uIdx}, #{oDelivery} )
	
	</insert>
	
	<!-- 주문확인서 내용 -->
	<!-- 주문 정보 가져오기 -->
	<select id="confirmationOrderInfo" resultType="ordersVO">
		SELECT O.*
		FROM ORDERS O, ORDERS_TEMP OT
		WHERE O.O_TEMPNUM = OT.O_TEMPNUM
	
	</select>
	<!-- 주문 정보에 대한 상품 정보 가져오기 -->
	<select id="confirmationProductInfo" resultType="productVO">
		SELECT P.*, A.O_TEMPNUM
		FROM PRODUCT P ,      
		(SELECT O.P_IDX, O.O_TEMPNUM
		FROM ORDERS O, ORDERS_TEMP OT
		WHERE O.O_TEMPNUM = OT.O_TEMPNUM) A
		WHERE P.P_IDX = A.P_IDX
	
	</select>
	<!-- 주문 정보에 대한 수령자 정보 가져오기 -->
	<select id="confirmationUserOrderInfo" resultType="userOrderVO">
		SELECT U.*, A.O_IDX
		FROM USER_ORDER U,
		(SELECT O.O_IDX, O.O_TEMPNUM
		FROM ORDERS O, ORDERS_TEMP OT
		WHERE O.O_TEMPNUM = OT.O_TEMPNUM) A
		WHERE U.O_IDX = A.O_IDX
	</select>
</mapper>